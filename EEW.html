<!DOCTYPE html>
<html lang="ko" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>사용자 맞춤형 지진정보서비스 - NECIS</title>
  <link rel="stylesheet" href="/pews/css/common.css">
  <link rel="stylesheet" href="/pews/css/snb.css">
</head>
<script>
var myLoc = new Object();
var tide = 0;
var binPath = "https://www.weather.go.kr/pews/data/";
var maxFavLen = 3;
var startDelay = 10000;
var eqkHist;

var ca = [11110,11140,11170,11200,11215,11230,11260,11290,11305,11320,11350,11380,11410,11440,11470,11500,11530,11545,11560,11590,11620,11650,11680,11710,11740,26110,26140,26170,26200,26230,26260,26290,26320,26350,26380,26410,26440,26470,26500,26530,26710,27110,27140,27170,27200,27230,27260,27290,27710,28110,28140,28177,28185,28200,28237,28245,28260,28710,28720,29110,29140,29155,29170,29200,30110,30140,30170,30200,30230,31110,31140,31170,31200,31710,36110,41111,41113,41115,41117,41131,41133,41135,41150,41171,41173,41190,41210,41220,41250,41271,41273,41281,41285,41287,41290,41310,41360,41370,41390,41410,41430,41450,41461,41463,41465,41480,41500,41550,41570,41590,41610,41630,41650,41670,41800,41820,41830,42110,42130,42150,42170,42190,42210,42230,42720,42730,42750,42760,42770,42780,42790,42800,42810,42820,42830,43111,43112,43113,43114,43130,43150,43720,43730,43740,43745,43750,43760,43770,43800,44131,44133,44150,44180,44200,44210,44230,44250,44270,44710,44760,44770,44790,44800,44810,44825,45111,45113,45130,45140,45180,45190,45210,45710,45720,45730,45740,45750,45770,45790,45800,46110,46130,46150,46170,46230,46710,46720,46730,46770,46780,46790,46800,46810,46820,46830,46840,46860,46870,46880,46890,46900,46910,47111,47113,47130,47150,47170,47190,47210,47230,47250,47280,47290,47720,47730,47750,47760,47770,47820,47830,47840,47850,47900,47920,47930,47940,48121,48123,48125,48127,48129,48170,48220,48240,48250,48270,48310,48330,48720,48730,48740,48820,48840,48850,48860,48870,48880,48890,50110,50130];
var da = ["서울,종로구,37.573172,126.97922,3975","서울,중구,37.56376,126.997459,3975","서울,용산구,37.532612,126.990182,4126","서울,성동구,37.563386,127.037047,3976","서울,광진구,37.53821,127.082191,4128","서울,동대문구,37.574428,127.039712,3976","서울,중랑구,37.606736,127.092924,3826","서울,성북구,37.58944,127.016817,3976","서울,강북구,37.639745,127.025547,3825","서울,도봉구,37.668639,127.047364,3674","서울,노원구,37.654375,127.056318,3675","서울,은평구,37.602766,126.928839,3823","서울,서대문구,37.579213,126.936773,3974","서울,마포구,37.566404,126.901763,3974,","서울,양천구,37.517019,126.866538,4124","서울,강서구,37.550968,126.849614,3972","서울,구로구,37.49565,126.887771,4275","서울,금천구,37.456979,126.895656,4275","서울,영등포구,37.52641,126.896252,4124","서울,동작구,37.512462,126.939485,4125","서울,관악구,37.478449,126.951758,4127","서울,서초구,37.48378,127.032733,4278","서울,강남구,37.517336,127.047367,4127","서울,송파구,37.514741,127.106052,4129","서울,강동구,37.53012,127.123858,4129","부산,중구,35.106333,129.032372,11415","부산,서구,35.097689,129.023906,11566","부산,동구,35.129298,129.045302,11415","부산,영도구,35.091224,129.067945,11567","부산,부산진구,35.162943,129.053097,11265","부산,동래구,35.205011,129.083632,11265","부산,남구,35.136318,129.084477,11416","부산,북구,35.197266,128.990201,11263","부산,해운대구,35.163096,129.1635,11267","부산,사하구,35.104503,128.974786,11414","부산,금정구,35.243036,129.092125,11114","부산,강서구,35.212155,128.980552,10961","부산,연제구,35.176273,129.079814,11265","부산,수영구,35.145568,129.113132,11417","부산,사상구,35.152585,128.991196,11263","부산,기장군,35.244476,129.222421,11117","대구,중구,35.869305,128.606199,9142","대구,동구,35.886576,128.635483,9142","대구,서구,35.871814,128.559166,9141","대구,남구,35.845968,128.597675,9292","대구,북구,35.885726,128.582811,9141","대구,수성구,35.85821,128.630739,9142","대구,달서구,35.829905,128.532806,9291","대구,달성군,35.774645,128.431478,9440","인천,중구,37.473715,126.621529,4270","인천,동구,37.473831,126.643266,4270","인천,미추홀구,37.463598,126.650573,4271","인천,연수구,37.410183,126.678313,4422","인천,남동구,37.447358,126.731623,4423","인천,부평구,37.506989,126.721668,4121","인천,계양구,37.537102,126.737663,4121","인천,서구,37.545374,126.675987,4120","인천,강화군,37.74745,126.487365,3512","인천,옹진군,37.446609,126.636785,4421","광주,동구,35.146085,126.923103,11373","광주,서구,35.151601,126.890072,12221","광주,남구,35.132829,126.902408,11373","광주,북구,35.174128,126.912084,11222","광주,광산구,35.139557,126.793672,11370","대전,동구,36.311886,127.454818,7760","대전,중구,36.325734,127.421365,7759","대전,서구,36.355413,127.383686,7607","대전,유성구,36.362289,127.356253,7607","대전,대덕구,36.346732,127.415617,7759","울산,중구,35.569376,129.332543,10062","울산,남구,35.543797,129.330113,10213","울산,동구,35.504813,129.416623,10215","울산,북구,35.582601,129.361283,10063","울산,울주군,35.52247,129.242209,10211","세종,세종시,36.592892,127.292362,7001","경기,수원시 장안구,37.303493,127.009678,4731","경기,수원시 권선구,37.25761,126.971702,4881","경기,수원시 팔달구,37.286534,127.035816,4882","경기,수원시 영통구,37.259508,127.046588,4882","경기,성남시 수정구,37.450292,127.145529,4280","경기,성남시 중원구,37.430641,127.137109,4431","경기,성남시 분당구,37.38275,127.118913,4583","경기,의정부시,37.738061,127.033893,3523","경기,안양시 만안구,37.386584,126.93234,4578","경기,안양시 동안구,37.392511,126.951274,4579","경기,부천시,37.503486,126.766046,4122","경기,광명시,37.478545,126.864711,4275","경기,평택시,36.992283,127.112653,5790","경기,동두천시,37.903591,127.060388,2920","경기,안산시 상록구,37.300841,126.846205,4727","경기,안산시 단원구,37.31959,126.812365,4727","경기,고양시 덕양구,37.637468,126.832374,3821","경기,고양시 일산동구,37.65895,126.774759,3669","경기,고양시 일산서구,37.675203,126.750664,3673","경기,과천시,37.429194,126.987607,4428","경기,구리시,37.594326,127.129606,3978","경기,남양주시,37.635977,127.216385,3829","경기,오산시,37.149891,127.077494,5336","경기,시흥시,37.380063,126.802797,4576","경기,군포시,37.361622,126.935121,4578","경기,의왕시,37.344823,126.968291,4730","경기,하남시,37.539257,127.214853,4131","경기,용인시 처인구,37.234494,127.201367,5037","경기,용인시 기흥구,37.280446,127.114683,4884","경기,용인시 수지구,37.322149,127.098082,4732","경기,파주시,37.760141,126.779958,3367","경기,이천시,37.272181,127.434993,4890","경기,안성시,37.008031,127.279768,5640","경기,김포시,37.615271,126.715648,3819","경기,화성시,37.199541,126.831438,5180","경기,광주시,37.429462,127.255175,4434","경기,양주시,37.785227,127.045835,3372","경기,포천시,37.894985,127.200368,3074","경기,여주시,37.298249,127.63721,4894","경기,연천군,38.096677,127.074874,2467","경기,가평군,37.831328,127.509551,3231","경기,양평군,37.491692,127.487591,4287","강원,춘천시,37.881272,127.730144,3084","강원,원주시,37.341707,127.919787,4749","강원,강릉시,37.752109,128.875899,3409","강원,동해시,37.524697,129.114375,4169","강원,태백시,37.164087,128.985759,5223","강원,속초시,38.207089,128.591917,2044","강원,삼척시,37.449935,129.165151,4472","강원,홍천군,37.696825,127.888675,3691","강원,횡성군,37.491874,127.984878,4297","강원,영월군,37.18368,128.461571,5213","강원,평창군,37.370755,128.390208,4607","강원,정선군,37.380645,128.660812,4613","강원,철원군,38.146758,127.313358,2321","강원,화천군,38.106092,127.708213,2329","강원,양구군,38.109959,127.989951,2334","강원,인제군,38.06976,128.170429,2489","강원,고성군,38.380542,128.467781,1589","강원,양양군,38.07539,128.618847,2498","충북,청주시 상당구,36.634684,127.48847,6854","충북,청주시 서원구,36.637684,127.469708,6854","충북,청주시 흥덕구,36.641489,127.431134,6853","충북,청주시 청원구,36.651447,127.486648,6703","충북,충주시,36.99108,127.925919,5806","충북,제천시,37.132628,128.190905,5358","충북,보은군,36.489468,127.729504,7312","충북,옥천군,36.306664,127.571294,7762","충북,영동군,36.175011,127.783425,8219","충북,증평군,36.785403,127.581673,6403","충북,진천군,36.85537,127.435452,6098","충북,괴산군,36.815281,127.786601,6256","충북,음성군,36.940288,127.690467,5952","충북,단양군,36.984664,128.365783,5815","충남,천안시 동남구,36.806985,127.150333,6244","충남,천안시 서북구,36.878428,127.155173,6093","충남,공주시,36.446589,127.119019,7451","충남,보령시,36.333459,126.6128,7743","충남,아산시,36.790076,127.002443,6392","충남,서산시,36.784965,126.450294,6381","충남,논산시,36.187163,127.098742,8205","충남,계룡시,36.274529,127.248676,7906","충남,당진시,36.889545,126.645567,6082","충남,금산군,36.108805,127.487902,8364","충남,부여군,36.275777,126.909812,7900","충남,서천군,36.080231,126.691313,8650","충남,청양군,36.459188,126.802258,7294","충남,홍성군,36.601357,126.660838,6838","충남,예산군,36.682731,126.84878,6690","충남,태안군,36.745739,126.297886,6528","전북,전주시 완산구,35.81218,127.119796,9263","전북,전주시 덕진구,35.829393,127.134326,9263","전북,군산시,35.967613,126.7368,8802","전북,익산시,35.948284,126.95759,8958","전북,정읍시,35.569845,126.856126,10013","전북,남원시,35.416414,127.390423,10476","전북,김제시,35.803591,126.880311,9258","전북,완주군,35.904737,127.161622,8962","전북,진안군,35.79197,127.424684,9420","전북,무주군,36.007103,127.660755,8670","전북,장수군,35.647385,127.521143,9875","전북,임실군,35.618216,127.289172,9870","전북,순창군,35.374285,127.13765,10622","전북,고창군,35.435781,126.701957,10463","전북,부안군,35.731725,126.733384,9557","전남,목포시,34.81191,126.392404,12268","전남,여수시,34.760444,127.662231,12445","전남,순천시,34.950612,127.487359,11837","전남,나주시,35.015837,126.710809,11671","전남,광양시,34.940676,127.695966,11992","전남,담양군,35.32118,126.988104,10770","전남,곡성군,35.282012,127.292012,10927","전남,구례군,35.202566,127.462817,11082","전남,고흥군,34.611232,127.285008,12890","전남,보성군,34.7715,127.080005,12433","전남,화순군,35.064587,126.986489,11525","전남,장흥군,34.681737,126.907008,12732","전남,강진군,34.642083,126.767142,12880","전남,해남군,34.573464,126.599183,13027","전남,영암군,34.800101,126.696823,12274","전남,무안군,34.990455,126.481667,11817","전남,함평군,35.065906,126.516536,11516","전남,영광군,35.277195,126.512012,10912","전남,장성군,35.301822,126.784836,10766","전남,완도군,34.31104,126.754902,13786","전남,진도군,34.486954,126.263558,13323","전남,신안군,34.833436,126.351473,12268","경북,포항시 남구,36.00865,129.35933,8704","경북,포항시 북구,36.041824,129.365649,8704","경북,경주시,35.83754367,129.2144188,9305","경북,김천시,36.139822,128.113657,8377","경북,안동시,36.568409,128.72962,7030","경북,구미시,36.119552,128.344499,8381","경북,영주시,36.805671,128.623988,6273","경북,영천시,35.973241,128.938597,8846","경북,상주시,36.410953,128.159142,7472","경북,문경시,36.586528,128.186769,7019","경북,경산시,35.825078,128.741271,9295","경북,군위군,36.242981,128.572901,8084","경북,의성군,36.352724,128.697164,7633","경북,청송군,36.436256,129.057101,7490","경북,영양군,36.666725,129.112395,6736","경북,영덕군,36.415069,129.366078,7496","경북,청도군,35.647469,128.734127,9899","경북,고령군,35.726098,128.262812,9588","경북,성주군,35.919119,128.282962,8984","경북,칠곡군,35.995518,128.401567,8836","경북,예천군,36.657704,128.45292,6723","경북,봉화군,36.893149,128.732665,6124","경북,울진군,36.993068,129.400533,5836","경북,울릉군,37.484426,130.90586,4356","경남,창원시 의창구,35.254005,128.640122,10954","경남,창원시 성산구,35.198465,128.702644,11258","경남,창원시 마산합포구,35.196928,128.567867,11255","경남,창원시 마산회원구,35.220822,128.579677,11104","경남,창원시 진해구,35.133204,128.710181,11409","경남,진주시,35.180119,128.107529,11246","경남,통영시,34.854366,128.433081,12158","경남,사천시,35.003466,128.064242,11698","경남,김해시,35.228588,128.889428,11110","경남,밀양시,35.503816,128.746619,10201","경남,거제시,34.880459,128.621121,12162","경남,양산시,35.335043,129.037407,10811","경남,의령군,35.32221,128.261686,10796","경남,함안군,35.272494,128.406464,10950","경남,창녕군,35.544566,128.492246,10196","경남,고성군,34.973037,128.32225,11854","경남,남해군,34.837348,127.892289,12298","경남,하동군,35.067313,127.751317,11541","경남,산청군,35.415678,127.873467,10486","경남,함양군,35.520371,127.725153,10181","경남,거창군,35.686719,127.909566,9732","경남,합천군,35.566621,128.165806,10039","제주,제주시,33.499562,126.531164,16348","제주,서귀포시,33.254083,126.56010,16953"];

var favArr = [19];

var dur = 300;
var locSet = false;

var simMode = "";
var iframe;
var simTO;
var getHist;
var iframe;
var init = true;
document.addEventListener("DOMContentLoaded", function(){
	if(location.search != null && location.search != "" && location.search != "?")
		favArr[0] = Number(location.search.substr(1).split(",")[0]);
	fn_selOnload();
	getHist = setInterval(function(){
		//if(iframe == null){
			//iframe = document.getElementById('iframe').contentWindow;
			//fn_getLoc();
		//}
		if(iframe.his){
			iframe.his = false;
			fn_getHist(iframe.latEvtId);
		}
	}, 500);
	iframe = document.getElementById('iframe').contentWindow;
	iframe.onload = function(){
		iframe.fn_setLocation(favArr);
		iframe.manual = "/pews/man/m_n.html";
		iframe.document.getElementById('fav').addEventListener('change', function(){
			fn_setSel();
			for(var i=0; i<eqkHist.length; i++){
				fn_applyDist(eqkHist[i], i);
			}
		});
		fn_getLoc();
		iframe.document.getElementById('alarmBtn').addEventListener('click', function(){
			fn_setAlarm(99);
		});
	};
});

function fn_getHist(evtId){
	var oReq = new XMLHttpRequest();
	oReq.overrideMimeType("application/json");
	oReq.open("GET", iframe.binPath + "list/" + evtId + ".l", true);
	oReq.onload = function(evt){
		eqkHist = JSON.parse(oReq.responseText);
		console.log(eqkHist);
		if(init){
			init = false;
			fn_buildSimList();
		}
		fn_sort(9);
	}
	oReq.send(null);
}

function fn_applyDist(data, idx){
	var selectedIdx = iframe.document.getElementById('fav').options.selectedIndex;
	var dist = fn_distCalc(iframe.myLoc[selectedIdx].lat, iframe.myLoc[selectedIdx].lon, data.lat, data.lon);
	document.getElementById('dist' + idx).innerHTML = Math.round(dist * 100) / 100 + "㎞";
}

function fn_distCalc(orgLat, orgLon, destLat, destLon){
	var theta = orgLon - destLon;
	var dist = Math.sin(fn_deg2rad(orgLat)) * Math.sin(fn_deg2rad(destLat));
	dist += Math.cos(fn_deg2rad(orgLat)) * Math.cos(fn_deg2rad(destLat)) * Math.cos(fn_deg2rad(theta));
	dist = fn_rad2deg(Math.acos(dist)) * 60 * 1.1515 * 1.609344;
	return dist;
}

function fn_deg2rad(deg){
	return (deg * Math.PI / 180);
}

function fn_rad2deg(rad){
	return (rad * 180 / Math.PI);
}

function fn_buildSimList(){
	document.getElementById('eqkList').innerHTML = "";
	for(var i=0; i<eqkHist.length; i++){
		fn_addEqkList(eqkHist[i], i);
	}
	iframe.document.getElementById('fav').addEventListener('change', function(){
		fn_setSel();
		for(var i=0; i<eqkHist.length; i++){
			fn_applyDist(eqkHist[i], i);
		}
	});
}

function fn_addEqkList(data, idx){
	var eqkInfoHtml = "";
	var start = new Date(fn_parseDate(data.ocr) - startDelay).format("yyyyMMddHHmmss");
	var dur = start < 20191101000000 ? 300 : 500;
	dur = data.loc.indexOf("북한") == -1 ? dur : 1200;
	if(simMode == data.id){
		eqkInfoHtml += "<li id=\"li" + idx + "\" style=\"background-color:#25A9B9\"><ul class='quake_info'>";
	}else{
		eqkInfoHtml += "<li id=\"li" + idx + "\"><ul class='quake_info'>";
	}
	eqkInfoHtml += 			"<li class='i_date'>" + data.ocr.substr(0,4) + "/" + data.ocr.substr(4,2) + "/" + data.ocr.substr(6,2) + "</li>";
	eqkInfoHtml += 			"<li class='i_time'>" + data.ocr.substr(8,2) + ":" + data.ocr.substr(10,2) + ":" + data.ocr.substr(12,2) + "</li>";
	eqkInfoHtml += 			"<li class='i_mag'>" + data.mag + "M<small>L</small></li>";
	eqkInfoHtml += 			"<li class='i_dist' id='dist" + idx + "'>0㎞</li>";
	eqkInfoHtml += 			"<li class='full i_info'>" + data.loc + "</li>";
	eqkInfoHtml += 			"<li class='full btn_wrap'>";
	eqkInfoHtml += 				"<button type='button' onclick='fn_src(\"" + start + "\",\"" + dur + "\",\"" + data.id + "\",\"" + idx + "\")' class='btn btn_mint'>시뮬레이션</button>";
	eqkInfoHtml += 				"<button type='button' onclick='fn_necis()' class='btn btn_blue'>NECIS 지진정보</button>";
	eqkInfoHtml += 				"<button type='button' onclick='fn_show(\"" + data.lat + "\",\"" + data.lon + "\")' class='btn btn_orange'>위치보기</button>";
	eqkInfoHtml += "</li></ul></li>";
	document.getElementById('eqkList').innerHTML += eqkInfoHtml;
}

function fn_selOnload(num){
	fn_loadLocation();
	for(var i=0; i<favArr.length; i++){
		var rIdx = favArr[i];
		document.getElementById('fav' + i + 'Loc').innerHTML = da[rIdx].split(",")[0] + " " + da[rIdx].split(",")[1];
		
		var selFav0 = document.getElementById('fav0' + i);
		for(var j=0; j<selFav0.options.length; j++){
			if(selFav0.options[j].value == ca[rIdx].toString().substr(0,2))
				selFav0.options[j].selected = true;
		}
		selFav0.disabled = true;
		
		var selFav1 = document.getElementById('fav1' + i);
		var op1 = new Option();
		op1.value = ca[rIdx].toString().substr(2,3);
		op1.text = da[rIdx].split(",")[1];
		selFav1.add(op1);
		selFav1.disabled = true;
		
		
	}
	fn_fav0Chg(1);
	fn_fav0Chg(2);
	fn_fav0Chg(3);
	
}

function fn_necis(){
	window.open("https://www.weather.go.kr/pews/man/uc.html", "알림", "width=500, height=600");
}

function fn_fav0Chg(num){
	if(document.getElementById('fav' + num + 'Loc').innerHTML.length == 0){
		var optionHtml = "";
		var sel0 = document.getElementById('fav0' + num);
		var sel1 = document.getElementById('fav1' + num);
		sel1.options.length = 0;
		for(var i=0; i<ca.length; i++){
			if(ca[i].toString().substr(0,2) == sel0.options[sel0.selectedIndex].value){
				var selArr = [];
				for(var j=1; j<4;j++){
					if(document.getElementById('fav' + j + 'Loc').innerHTML.length != 0){
						var fav0 = document.getElementById('fav0' + j);
						var fav1 = document.getElementById('fav1' + j);
						var rc = fav0.options[fav0.options.selectedIndex].value + fav1.options[fav1.options.selectedIndex].value;
						selArr.push(rc);
					}
				}
				if(selArr.indexOf(ca[i].toString()) == -1){
					var op = new Option();
					op.value = ca[i].toString().substr(2,3);
					op.text = da[i].split(",")[1];
					sel1.add(op);
				}
			}
		}
	}
}

function fn_addFav(num){
	var sel0 = document.getElementById('fav0' + num);
	var sel1 = document.getElementById('fav1' + num);
	sel0.disabled = true;
	sel1.disabled = true;
	var regCode = sel0.options[sel0.selectedIndex].value + sel1.options[sel1.selectedIndex].value;
	var regStr = sel0.options[sel0.selectedIndex].text + " " + sel1.options[sel1.selectedIndex].text; 
	favArr.push(ca.indexOf(Number(regCode)));
	fn_saveLocation();
	iframe.fn_setLocation(favArr);
	iframe.fn_favChg();
	document.getElementById('fav' + num + 'Loc').innerHTML = regStr;
	fn_fav0Chg(1);
	fn_fav0Chg(2);
	fn_fav0Chg(3);
}

function fn_delFav(num){
	var sel0 = document.getElementById('fav0' + num);
	var sel1 = document.getElementById('fav1' + num);
	sel0.disabled = false;
	sel1.disabled = false;
	var regCode = sel0.options[sel0.selectedIndex].value + sel1.options[sel1.selectedIndex].value;
	favArr.splice(favArr.indexOf(ca.indexOf(Number(regCode))), 1);
	fn_saveLocation();
	iframe.fn_setLocation(favArr);
	iframe.fn_favChg();
	fn_fav0Chg(1);
	fn_fav0Chg(2);
	fn_fav0Chg(3);
	document.getElementById('fav' + num + 'Loc').innerHTML = "";
	fn_fav0Chg(1);
	fn_fav0Chg(2);
	fn_fav0Chg(3);
}

function fn_tab(){
	if(document.getElementById("tabBtn1").classList.contains("on")){
		document.getElementById("tabBtn1").classList.remove("on");
		document.getElementById("tabBtn2").classList.add("on");
		document.getElementById("menu1").style.visibility = "hidden";
		document.getElementById("menu2").style.visibility = "visible";
	}else if(document.getElementById("tabBtn2").classList.contains("on")){
		document.getElementById("tabBtn1").classList.add("on");
		document.getElementById("tabBtn2").classList.remove("on");
		document.getElementById("menu1").style.visibility = "visible";
		document.getElementById("menu2").style.visibility = "hidden";
	}
}

function fn_src(ocr, eqkDuration, eqkID, idx){
	clearInterval(simTO);
	if(ocr == 0){
		iframe.sim = false; // 요기
		iframe.headerLen = 4;
		iframe.binPath = binPath;
		iframe.tide = tide;
		// iframe.document.getElementById('title').innerHTML = "<h1>사용자 맞춤형 지진정보 서비스</h1>";
		for(var i=0; i<eqkHist.length; i++){
			document.getElementById('li' + i).setAttribute("style", "background-color:#FFFFFF");
		}
		iframe.document.getElementById('time').style.color = "#FFFFFF";
		iframe.fn_renewSta();
	}else{
		simMode = eqkID;
		if(tide == 0){
			tide = iframe.tide;
		}else{
			tide = Math.min(iframe.tide, tide);
		}
		for(var i=0; i<eqkHist.length; i++){
			document.getElementById('li' + i).setAttribute("style", "background-color:#FFFFFF");
		}
		document.getElementById('li' + idx).setAttribute("style", "background-color:#25A9B9");
		iframe.document.getElementById('time').style.color = "#FFFF00";
		// iframe.document.getElementById('title').innerHTML = "<h1 class='simul'>사용자 맞춤형 지진정보 서비스<span>[시뮬레이션]</span></h1>";
		iframe.sim = true; // 요기
		iframe.headerLen = 1;
		iframe.tide = new Date().getTime() - new Date(ocr.substr(0,4), Number(ocr.substr(4,2)) - 1, ocr.substr(6,2), ocr.substr(8,2), ocr.substr(10,2), ocr.substr(12,2)).getTime();
		iframe.binPath = binPath;
		iframe.binPath += eqkID + "/";
		iframe.fn_renewSta();
		simTO = setTimeout(function(){
			iframe.binPath = binPath;
			iframe.tide = tide;
			iframe.sim = false; // 요기
			iframe.headerLen = 4;
			// iframe.document.getElementById('title').innerHTML = "<h1>사용자 맞춤형 지진정보 서비스</h1>";
			simMode = "";
			for(var i=0; i<eqkHist.length; i++){
				document.getElementById('li' + i).setAttribute("style", "background-color:#FFFFFF");
			}
			iframe.document.getElementById('time').style.color = "#FFFFFF";
			iframe.fn_renewSta();
		}, eqkDuration * 1000);
	}
}



function fn_parseDate(date){
	return new Date(date.toString().substr(0,4), date.toString().substr(4,2) - 1, date.toString().substr(6,2), date.toString().substr(8,2), date.toString().substr(10,2), date.toString().substr(12,2)).getTime();
}

function fn_distance(originA, originB, destA, destB){
	return Math.sqrt(Math.pow(Number(originA) - Number(destA), 2) + Math.pow(Number(originB) - Number(destB), 2)); 
}

function fn_sort(idx){
	var sor0 = document.getElementById('sort0');
	var sor1 = document.getElementById('sort1');
	var sor2 = document.getElementById('sort2');
	var styleS = "background-color:#256CB9;color:#FFFFFF";
	var styleU = "background-color:#FFFFFF;color:#858585";
	switch(idx){
	case 0 :
		sor0.style = styleS;
		sor1.style = sor2.style = styleU;
		sor1.class = "sort desc";
		sor1.innerHTML = "&dtrif;";
		sor2.class = "sort asc";
		sor2.innerHTML = "&utrif;";
		if(sor0.class == "sort desc"){
			sor0.class = "sort asc";
			sor0.innerHTML = "&utrif;";
			eqkHist = eqkHist.sort(function(a, b){
				return a["ocr"] - b["ocr"];
			});
		}else{
			sor0.class = "sort desc";
			sor0.innerHTML = "&dtrif;";
			eqkHist = eqkHist.sort(function(a, b){
				return b["ocr"] - a["ocr"];
			});
		}
		break;
	case 1 : 
		sor1.style = styleS;
		sor0.style = sor2.style = styleU;
		sor0.class = "sort desc";
		sor0.innerHTML = "&dtrif;";
		sor2.class = "sort asc";
		sor2.innerHTML = "&utrif;";
		if(sor1.class == "sort desc"){
			sor1.class = "sort asc";
			sor1.innerHTML = "&utrif;";
			eqkHist = eqkHist.sort(function(a, b){
				return a["mag"] - b["mag"];
			});
		}else{
			sor1.class = "sort desc";
			sor1.innerHTML = "&dtrif;";
			eqkHist = eqkHist.sort(function(a, b){
				return b["mag"] - a["mag"];
			});
		}
		break;
	case 2 :
		sor2.style = styleS;
		sor0.style = sor1.style = styleU;
		sor0.class = sor1.class = "sort desc";
		sor0.innerHTML = sor1.innerHTML = "&dtrif;";
		if(sor2.class == "sort desc"){
			sor2.class = "sort asc";
			sor2.innerHTML = "&utrif;";
			eqkHist = eqkHist.sort(function(a, b){
				var selIdx = iframe.document.getElementById('fav').options.selectedIndex;
				var selLat = iframe.myLoc[selIdx].lat;
				var selLon = iframe.myLoc[selIdx].lon;
				return fn_distCalc(a["lat"], a["lon"], selLat, selLon) - fn_distCalc(b["lat"], b["lon"], selLat, selLon);
			});
		}else{
			sor2.class = "sort desc";
			sor2.innerHTML = "&dtrif;";
			eqkHist = eqkHist.sort(function(a, b){
				var selIdx = iframe.document.getElementById('fav').options.selectedIndex;
				var selLat = iframe.myLoc[selIdx].lat;
				var selLon = iframe.myLoc[selIdx].lon;
				return fn_distCalc(b["lat"], b["lon"], selLat, selLon) - fn_distCalc(a["lat"], a["lon"], selLat, selLon);
			});
		}
		break;
	case 9 :
		sor0.style = styleS;
		sor1.style = sor2.style = styleU;
		sor1.class = "sort desc";
		sor1.innerHTML = "&dtrif;";
		sor2.class = "sort asc";
		sor2.innerHTML = "&utrif;";
		sor0.class = "sort desc";
		sor0.innerHTML = "&dtrif;";
		eqkHist = eqkHist.sort(function(a, b){
			return b["ocr"] - a["ocr"];
		});
	}
	document.getElementById('eqkList').innerHTML = "";
	for(var i=0; i<eqkHist.length; i++){
		fn_addEqkList(eqkHist[i], i);
		fn_applyDist(eqkHist[i], i);
	}
	return false;
}

function fn_show(simLat, simLon){
	iframe.simY = iframe.fn_parseY(simLat);
	iframe.simX = iframe.fn_parseX(simLon);
	iframe.show = true;
}

function fn_filChg(mag){
	iframe.filter = mag;
}

function fn_fold(){
	if(!locSet){
		for(var i=0; i<eqkHist.length; i++){
			fn_applyDist(eqkHist[i], i);
		}
		locSet = true;
	}
	var foldButton = document.getElementById('fold');
	var wrap = document.getElementById('wrap');
	if(wrap.classList.contains('foldSnb')){
		foldButton.innerHTML = "◀";
		wrap.classList.remove('foldSnb');
	}else{
		foldButton.innerHTML = "▶";
		wrap.classList.add('foldSnb');
	}
}

Date.prototype.format = function(f) {
    if (!this.valueOf()) return " ";
 
    var weekName = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
    var d = this;
     
    return f.replace(/(yyyy|yy|MM|dd|E|hh|mm|ss|a\/p)/gi, function($1) {
        switch ($1) {
            case "yyyy": return d.getFullYear();
            case "yy": return (d.getFullYear() % 1000).zf(2);
            case "MM": return (d.getMonth() + 1).zf(2);
            case "dd": return d.getDate().zf(2);
            case "E": return weekName[d.getDay()];
            case "HH": return d.getHours().zf(2);
            case "hh": return ((h = d.getHours() % 12) ? h : 12).zf(2);
            case "mm": return d.getMinutes().zf(2);
            case "ss": return d.getSeconds().zf(2);
            case "a/p": return d.getHours() < 12 ? "오전" : "오후";
            default: return $1;
        }
    });
};
 
String.prototype.string = function(len){var s = '', i = 0; while (i++ < len) { s += this; } return s;};
String.prototype.zf = function(len){return "0".string(len - this.length) + this;};
Number.prototype.zf = function(len){return this.toString().zf(len);};

function fn_getLoc(){
	var nIdx = Number(localStorage.getItem("N_S") == null ? 0 : localStorage.getItem("N_S"));
	iframe.document.getElementById('fav').options[nIdx].selected = true;
	iframe.fn_favChg();
}

function fn_setSel(){
	localStorage.setItem("N_S", iframe.document.getElementById('fav').selectedIndex);
}

function fn_saveLocation(){
	localStorage.setItem("N_L", favArr);
}

function fn_loadLocation(){
	if(localStorage.getItem("N_L") != null){
		var rArr = localStorage.getItem("N_L").split(",");
		for(var i=1; i<rArr.length; i++){
			favArr.push(Number(rArr[i]));
		}
	}
}

function fn_setAlarm(idx){
console.log("alarm" + idx);
	
	var alarmBtn = iframe.document.getElementById('alarmBtn');
	
	if(idx == 99){	
		if(alarmBtn.src.indexOf("on") != -1){
			alarmBtn.src = "img/sound_off.png";
			iframe.alarmReg = [];
			for(var i=0; i<18; i++){
				document.getElementById('alarmR' + i).src = "img/sound_off.png";
			}
		}else{
			alarmBtn.src = "img/sound_on.png";
			iframe.alarmReg = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17];
			for(var i=0; i<18; i++){
				document.getElementById('alarmR' + i).src = "img/sound_on.png";
			}
		}
		iframe.fn_setAlarm();
	}else{
		if(iframe.alarmReg.indexOf(idx) == -1){
			iframe.alarmReg.push(idx);
			document.getElementById('alarmR' + idx).src = "img/sound_on.png";
		}else{
			iframe.alarmReg.splice(iframe.alarmReg.indexOf(idx), 1);
			document.getElementById('alarmR' + idx).src = "img/sound_off.png";
		}
		if(iframe.alarmReg.length == 0){
			alarmBtn.src = "img/sound_off.png";
		}else{
			alarmBtn.src = "img/sound_on.png";
		}
	}
}

function fn_top(){
	document.getElementById('list').scrollTop = 0;
}
</script>
<body>
	<div class="wrap foldSnb" id="wrap">
  <div class="snb">
	<button type="button" id="fold" class="fold" onclick="fn_fold()">▶</button>
    <ul class="snb_list" data-role="navbar">
      <li id="tabBtn1" onclick="fn_tab()" class="on"><h1 value="menu1">과거지진목록</h1></li>
      <li id="tabBtn2" onclick="fn_tab()"><h1 value="menu2">관심지역설정</h1></li>
    </ul>
    <div class="snb_cont" data-role="s_container" style="position:relative">
		<div id="menu1" class="s_content past_quake" style="position:absolute;bottom:0px;right:0px">
        <div class="tit blind">
          <h2>과거지진목록</h2>
        </div>
		<div class="filter" style="height:40px">
			<button type="button" onclick="fn_src(0)" class="btn btn_redLine" style="height:100%;width:100%">시뮬레이션 종료</button>
		</div>
        <div class="filter">
          <ul>
            <li class="i_date">날짜
              <a href="javascript:;" id="sort0" onclick="fn_sort(0)" class="sort desc" style="background-color:#256CB9;color:#FFFFFF">&dtrif;</a>
            </li>
            <li class="i_mag">규모
              <a href="javascript:;" id="sort1" onclick="fn_sort(1)" class="sort desc" style="background-color:#FFFFFF:color:#858585">&dtrif;</a>
            </li>
            <li class="i_dist">거리
              <a href="javascript:;" id="sort2" onclick="fn_sort(2)" class="sort asc" style="background-color:#FFFFFF;color:#858585">&utrif;</a>
            </li>
          </ul>
        </div>
        <div class="quake" id="list">
          <ul id="eqkList" class="quake_list">
          </ul>
        </div>
        <div class="btn_AreaB">
          <button type="button" onclick="fn_top()" class="btn btn_blackLine">맨위로</button>
        </div>
      </div>
      <div id="menu2" class="s_content set_area" style="position:absolute;bottom:0px;right:0px;visibility:hidden">
		<!--<div class="filter" style="height:40px">
			<input type="radio" name="magFilter" onchange="fn_filChg(2)" value="2.0" checked="checked">2.0이상</input>
			<input type="radio" name="magFilter" onchange="fn_filChg(3)" value="3.0">3.0이상</input>
			<input type="radio" name="magFilter" onchange="fn_filChg(3.5)" value="3.5">3.5이상</input>
			<input type="radio" name="magFilter" onchange="fn_filChg(4)" value="4.0">4.0이상</input>
		</div>-->
        <div class="tit">
          <h2>관심지역 설정</h2>
        </div>
        <div class="area_list">
			<dl>
				<dt>내 위치
				  <span class="fr">
					<!--<button type="button" onclick="" class="btn btn_blueLine">변경</button>-->
				  </span> 
				</dt>
				<dd class="area_name">
				  <span id="fav0Loc"></span>
				</dd>
				<dd class="hidden_dd">
				  <select name="fav0" id="fav00" title="지역선택" disabled>
					<option value="11" selected>서울</option>
					<option value="26">부산</option>
					<option value="27">대구</option>
					<option value="28">인천</option>
					<option value="29">광주</option>
					<option value="30">대전</option>
					<option value="31">울산</option>
					<option value="36">세종</option>
					<option value="41">경기</option>
					<option value="42">강원</option>
					<option value="43">충북</option>
					<option value="44">충남</option>
					<option value="45">전북</option>
					<option value="46">전남</option>
					<option value="47">경북</option>
					<option value="48">경남</option>
					<option value="50">제주</option>
				  </select>
				  <select name="fav1" id="fav10" title="상세지역"disabled>
				  </select>
				  <!--<span class="btn_wrap">
					<button type="button" onclick="" class="btn btn_blackLine">취소</button>
				  </span>-->
				</dd>
				<!--<dd>
				  <p>
					삭제하시겠습니까?<br />
					나중에 추가하실 수 있습니다.
				  </p>
				  <span class="btn_wrap">
					<button type="button" onclick="" class="btn btn_blueLine">확인</button>
					<button type="button" onclick="" class="btn btn_blackLine">취소</button>
				  </span>
				</dd>-->
			
				<dt>관심지역 1
				  <span class="fr">
					<!--<button type="button" onclick="" class="btn btn_blueLine">변경</button>-->
				  </span> 
				</dt>
				<dd class="area_name">
				  <span id="fav1Loc"></span>
				  <span class="fr">					
					<button type="button" onclick="fn_addFav(1)" class="btn btn_blueLine">설정</button>
					<button type="button" onclick="fn_delFav(1)" class="btn btn_blackLine">삭제</button>
				  </span>
				</dd>
				<dd>
				  <select name="fav0" id="fav01" title="지역선택" onchange="fn_fav0Chg(1)">
					<option value="11" selected>서울</option>
					<option value="26">부산</option>
					<option value="27">대구</option>
					<option value="28">인천</option>
					<option value="29">광주</option>
					<option value="30">대전</option>
					<option value="31">울산</option>
					<option value="36">세종</option>
					<option value="41">경기</option>
					<option value="42">강원</option>
					<option value="43">충북</option>
					<option value="44">충남</option>
					<option value="45">전북</option>
					<option value="46">전남</option>
					<option value="47">경북</option>
					<option value="48">경남</option>
					<option value="50">제주</option>
				  </select>
				  <select name="fav1" id="fav11" title="상세지역">
				  </select>
				  <!--<span class="btn_wrap">
					<button type="button" onclick="" class="btn btn_blackLine">취소</button>
				  </span>-->
				</dd>
				<!--<dd>
				  <p>
					삭제하시겠습니까?<br />
					나중에 추가하실 수 있습니다.
				  </p>
				  <span class="btn_wrap">
					<button type="button" onclick="" class="btn btn_blueLine">확인</button>
					<button type="button" onclick="" class="btn btn_blackLine">취소</button>
				  </span>
				</dd>-->
			
				<dt>관심지역 2
				  <span class="fr">
					<!--<button type="button" onclick="" class="btn btn_blueLine">변경</button>-->
				  </span> 
				</dt>
				<dd class="area_name">
				  <span id="fav2Loc"></span>
				  <span class="fr">
					<button type="button" onclick="fn_addFav(2)" class="btn btn_blueLine">설정</button>
					<button type="button" onclick="fn_delFav(2)" class="btn btn_blackLine">삭제</button>
				  </span>
				</dd>
				<dd>
				  <select name="fav0" id="fav02" title="지역선택" onchange="fn_fav0Chg(2)">
					<option value="11" selected>서울</option>
					<option value="26">부산</option>
					<option value="27">대구</option>
					<option value="28">인천</option>
					<option value="29">광주</option>
					<option value="30">대전</option>
					<option value="31">울산</option>
					<option value="36">세종</option>
					<option value="41">경기</option>
					<option value="42">강원</option>
					<option value="43">충북</option>
					<option value="44">충남</option>
					<option value="45">전북</option>
					<option value="46">전남</option>
					<option value="47">경북</option>
					<option value="48">경남</option>
					<option value="50">제주</option>
				  </select>
				  <select name="fav1" id="fav12" title="상세지역">
				  </select>
				  <!--<span class="btn_wrap">
					
					<button type="button" onclick="" class="btn btn_blackLine">취소</button>
				  </span>-->
				</dd>
			
				<dt>관심지역 3
				  <span class="fr">
					<!--<button type="button" onclick="" class="btn btn_blueLine">변경</button>-->
				  </span> 
				</dt>
				<dd class="area_name">
				  <span id="fav3Loc"></span>
				  <span class="fr">
					<button type="button" onclick="fn_addFav(3)" class="btn btn_blueLine">설정</button>
					<button type="button" onclick="fn_delFav(3)" class="btn btn_blackLine">삭제</button>
				  </span>
				</dd>
				<dd>
				  <select name="fav0" id="fav03" title="지역선택" onchange="fn_fav0Chg(3)">
					<option value="11" selected>서울</option>
					<option value="26">부산</option>
					<option value="27">대구</option>
					<option value="28">인천</option>
					<option value="29">광주</option>
					<option value="30">대전</option>
					<option value="31">울산</option>
					<option value="36">세종</option>
					<option value="41">경기</option>
					<option value="42">강원</option>
					<option value="43">충북</option>
					<option value="44">충남</option>
					<option value="45">전북</option>
					<option value="46">전남</option>
					<option value="47">경북</option>
					<option value="48">경남</option>
					<option value="50">제주</option>
				  </select>
				  <select name="fav1" id="fav13" title="상세지역">
				  </select>
				  <!--<span class="btn_wrap">
					
					<button type="button" onclick="" class="btn btn_blackLine">취소</button>
				  </span>-->
				</dd>
			</dl>
		<!--
		<dl>
            <dt>관심지역
              <span class="fr">
                <button type="button" onclick="" class="btn btn_redLine">추가</button>
              </span>
            </dt>
		</dl>
		<dl>
            <dt>관심지역
              <span class="fr">
                <button type="button" onclick="" class="btn btn_redLine">추가</button>
              </span>
            </dt>
          </dl>-->
        </div>
		<div class="alert_area">
			<div class="tit">
			  <h2>알람지역 설정</h2>
			  <!--
			  <span class="fr">
				<label for="alarm">전체<img src="/pews/img/sound_on.png" id="alarmAll" onclick="fn_setAlarm(99)" alt="전체지역" /></label>
			  </span>
			  -->
			</div>
			<div id="alarm">
				<ul class="alm_list">
					<li onclick="fn_setAlarm(0)"><img src="/pews/img/sound_on.png" id="alarmR0" alt="서울 알람" /><label for="alarmR0">서울</label></li>
					<li onclick="fn_setAlarm(1)"><img src="/pews/img/sound_on.png" id="alarmR1" alt="부산 알람" /><label for="alarmR1">부산</label></li>
					<li onclick="fn_setAlarm(2)"><img src="/pews/img/sound_on.png" id="alarmR2" alt="대구 알람" /><label for="alarmR2">대구</label></li>
					<li onclick="fn_setAlarm(3)"><img src="/pews/img/sound_on.png" id="alarmR3" alt="인천 알람" /><label for="alarmR3">인천</label></li>
					<li onclick="fn_setAlarm(4)"><img src="/pews/img/sound_on.png" id="alarmR4" alt="광주 알람" /><label for="alarmR4">광주</label></li>
					<li onclick="fn_setAlarm(5)"><img src="/pews/img/sound_on.png" id="alarmR5" alt="대전 알람" /><label for="alarmR5">대전</label></li>
					<li onclick="fn_setAlarm(6)"><img src="/pews/img/sound_on.png" id="alarmR6" alt="울산 알람" /><label for="alarmR6">울산</label></li>
					<li onclick="fn_setAlarm(7)"><img src="/pews/img/sound_on.png" id="alarmR7" alt="세종 알람" /><label for="alarmR7">세종</label></li>
					<li onclick="fn_setAlarm(8)"><img src="/pews/img/sound_on.png" id="alarmR8" alt="경기 알람" /><label for="alarmR8">경기</label></li>
					<li onclick="fn_setAlarm(9)"><img src="/pews/img/sound_on.png" id="alarmR9" alt="강원 알람" /><label for="alarmR9">강원</label></li>
					<li onclick="fn_setAlarm(10)"><img src="/pews/img/sound_on.png" id="alarmR10" alt="충북 알람" /><label for="alarmR10">충북</label></li>
					<li onclick="fn_setAlarm(11)"><img src="/pews/img/sound_on.png" id="alarmR11" alt="충남 알람" /><label for="alarmR11">충남</label></li>
					<li onclick="fn_setAlarm(12)"><img src="/pews/img/sound_on.png" id="alarmR12" alt="전북 알람" /><label for="alarmR12">전북</label></li>
					<li onclick="fn_setAlarm(13)"><img src="/pews/img/sound_on.png" id="alarmR13" alt="전남 알람" /><label for="alarmR13">전남</label></li>
					<li onclick="fn_setAlarm(14)"><img src="/pews/img/sound_on.png" id="alarmR14" alt="경북 알람" /><label for="alarmR14">경북</label></li>
					<li onclick="fn_setAlarm(15)"><img src="/pews/img/sound_on.png" id="alarmR15" alt="경남 알람" /><label for="alarmR15">경남</label></li>
					<li onclick="fn_setAlarm(16)"><img src="/pews/img/sound_on.png" id="alarmR16" alt="제주 알람" /><label for="alarmR16">제주</label></li>
					<li onclick="fn_setAlarm(17)"><img src="/pews/img/sound_on.png" id="alarmR17" alt="해역 알람" /><label for="alarmR17">해역</label></li>
				</ul>					
			</div>
		</div>
	  </div>
    </div>    
  </div>
  <div class="content">
	<iframe id="iframe" class="iframe" src="https://www.weather.go.kr/pews/pews.html"></iframe>
  </div>
  </div>
</body>
</html>			
